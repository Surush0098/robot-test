<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>تست حرکت اجباری</title>
    <style>
        body { margin: 0; background-color: #333; overflow: hidden; }
        #status {
            position: absolute; top: 10px; left: 10px;
            background: rgba(0,0,0,0.8); color: lime; padding: 10px;
            font-family: monospace; font-size: 14px; pointer-events: none;
            max-height: 90vh; overflow-y: auto; width: 300px;
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>
    <div id="status">در حال لود...</div>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // 1. صحنه
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x222222);
        
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 100);
        camera.position.set(0, 1.5, 4);
        
        const renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        
        const controls = new OrbitControls(camera, renderer.domElement);
        scene.add(new THREE.DirectionalLight(0xffffff, 2));
        scene.add(new THREE.AmbientLight(0xffffff, 1));

        const logDiv = document.getElementById('status');
        function log(msg) { logDiv.innerHTML += msg + "<br>"; }

        // لیست قطعاتی که قراره تکون بدیم
        const movingParts = [];

        // 2. لودر
        const loader = new GLTFLoader();
        
        loader.load('./Robotx.glb', function(gltf) {
            const model = gltf.scene;
            scene.add(model);
            model.position.y = -1;

            log("--- شروع جستجو برای حرکت ---");

            // گشتن توی کل اجزا (مهم نیست استخوان باشه یا نه)
            model.traverse((o) => {
                let name = o.name.toLowerCase();
                
                // لیست کلماتی که میخوایم تکون بخورن
                // (سر، گردن، ستون فقرات، پاها)
                if (name.includes('head') || 
                    name.includes('neck') || 
                    name.includes('spine') || 
                    name.includes('leg') ||
                    name.includes('arm')) {
                    
                    // فیلتر کردن چیزهای الکی (مثل نوک انگشت یا اندکتورها)
                    if (!name.includes('end') && !name.includes('nub')) {
                        movingParts.push(o);
                        log(`✅ متصل شد: <span style="color:yellow">${o.name}</span>`);
                    }
                }
            });

            if (movingParts.length === 0) {
                log("<span style='color:red'>هیچ قطعه‌ای با این نام‌ها پیدا نشد!</span>");
            } else {
                log(`<br>تعداد ${movingParts.length} قطعه پیدا شد و داره تکون میخوره!`);
            }

        }, undefined, function(e) {
            log("خطا در لود فایل.");
        });

        // 3. انیمیشن اتوماتیک
        function animate() {
            requestAnimationFrame(animate);
            
            const time = Date.now() * 0.002; // سرعت زمان

            // چرخاندن تمام قطعات پیدا شده
            movingParts.forEach(part => {
                // یک حرکت سینوسی (رفت و برگشت)
                // هر قطعه رو توی محورهای مختلف کمی تکون میدیم
                
                if (part.name.toLowerCase().includes('head')) {
                    part.rotation.y = Math.sin(time) * 0.5; // سر: چپ و راست
                } 
                else if (part.name.toLowerCase().includes('neck')) {
                    part.rotation.x = Math.sin(time) * 0.3; // گردن: بالا پایین
                }
                else if (part.name.toLowerCase().includes('spine')) {
                    part.rotation.z = Math.sin(time) * 0.1; // کمر: کمی کج شدن
                }
                else {
                    // دست و پا و بقیه چیزها
                    part.rotation.z = Math.sin(time) * 0.2;
                }
            });

            renderer.render(scene, camera);
        }

        animate();
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>